Before:
  call system('touch ~/test.file')

After:
  let g:ticket_auto_save = 0
  let g:ticket_auto_open = 0
  call system('rm ~/test.file')


Execute(expect GetBranchName pass):
  let branchname = system(
    \ 'git symbolic-ref --short HEAD | tr "/" "\n" | tail -n 1 | tr -d "\n"'
    \ )
  AssertEqual
    \ GetBranchName(),
    \ branchname

Execute(expect g:ticket_autosave to autoset to zero):
  AssertEqual
    \ g:ticket_auto_save,
    \ 0

Execute(expect g:ticket_autoopen to autoset to zero):
  AssertEqual
    \ g:ticket_auto_open,
    \ 0

Execute(expect CheckFileExists fail):
  AssertThrows
    \ CheckFileExists('/home/nonfile')

Execute(expect CheckFileExists pass):
  AssertEqual
    \ CheckFileExists(expand('~') . '/test.file'),
    \ expand('~') . '/test.file'

Execute(expect CheckIfGitRepo fail):
  :cd /
  AssertThrows
    \ CheckIfGitRepo()
  :cd -

Execute(expect CheckIfGitRepo pass):
  AssertEqual
    \ CheckIfGitRepo(),
    \ 0

Execute(expect GetRepoName fail):
  :cd /
  AssertThrows
    \ GetRepoName()
  :cd -

Execute(expect GetRepoName pass):
  AssertEqual
    \ GetRepoName(),
    \ 'ticket.vim'

Execute(expect GitDirPath pass):
  AssertEqual
    \ GetDirPath(),
    \ '~/.tickets/ticket.vim'

Execute(expect GitDirPath fail):
  :cd /
  AssertThrows
    \ GetDirPath()
  :cd -

Execute(expect GetFilePath session pass):
  AssertEqual
    \ GetFilePath('.vim'),
    \ '~/.tickets/ticket.vim/' . GetBranchName() . '.vim'

Execute(expect GetFilePath markdown pass):
  AssertEqual
    \ GetFilePath('.md'),
    \ '~/.tickets/ticket.vim/' . GetBranchName() . '.md'

Execute(expect GetFilePathOnlyIfExists pass):
  call CreateSession()
  AssertEqual
    \ GetFilePathOnlyIfExists('.vim'),
    \ '~/.tickets/ticket.vim/' . GetBranchName() . '.vim'

Execute(expect GetFilePathOnlyIfExists fail):
  AssertThrows
    \ GetFilePathOnlyIfExists('.py')

Execute(expect CreateSession pass):
  call CreateSession()
  Assert
    \ filereadable(
    \   expand('~/.tickets/ticket.vim/' . GetBranchName() . '.vim')
    \ )

Execute(expect CreateNote pass):
  call CreateNote()
  Assert
    \ filereadable(
    \   expand('~/.tickets/ticket.vim/' . GetBranchName() . '.md')
    \ )

Execute(expect DetermineAutoOpen pass):
  let g:ticket_auto_open = 1
  call CreateSession()
  AssertEqual
    \ DetermineAutoOpen(),
    \ 1

Execute(expect DetermineAutoOpen fail):
  call CreateSession()
  AssertEqual
    \ DetermineAutoOpen(),
    \ 0

Execute(expect DetermineAutoOpen fail due to no session file):
  let g:ticket_auto_open = 1
  call system('rm ~/.tickets/ticket.vim/' . GetBranchName() . '.vim')
  AssertEqual
    \ DetermineAutoOpen(),
    \ 0

Execute(expect DetermineAutoSave pass):
  let g:ticket_auto_save = 1
  AssertEqual
    \ DetermineAutoSave(),
    \ 1

Execute(expect DetermineAutoSave fail):
  AssertEqual
    \ DetermineAutoSave(),
    \ 0

" TODO: does not work during travis ci but does locally
" I suspect it has something to do with the changing dirs, perhaps
" `cd -` is not being executed

" Execute(expect DetermineAutoSave fail because not in git repo):
"   :cd /
"   let g:ticket_auto_save = 1
"   AssertEqual
"     \ DetermineAutoSave(),
"     \ 0
"   :cd - 
